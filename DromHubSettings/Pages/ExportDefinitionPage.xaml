<Page
    x:Class="DromHubSettings.Pages.ExportDefinitionPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:DromHubSettings.ViewModels"
    xmlns:models="using:DromHubSettings.Models"
    xmlns:dialogs="using:DromHubSettings.Dialogs"
    Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}">

    <!-- Привязка ViewModel через XAML -->
    <Page.DataContext>
        <vm:ExportDefinitionViewModel/>
    </Page.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок и описание страницы -->
        <StackPanel Grid.Row="0" Margin="20">
            <TextBlock Text="Настройки разметки Excel"
                       Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock Text="Укажите начальную строку и настройте столбцы (название, индекс, свойство)."
                       Style="{StaticResource BodyTextBlockStyle}"
                       Margin="0,8,0,0"/>
        </StackPanel>

        <!-- Основная часть (начальная строка и список столбцов) -->
        <StackPanel Grid.Row="1" Margin="20" Spacing="12">

            <!-- (1) Блок «Начальная строка» -->
            <Border BorderThickness="1" BorderBrush="Gray" CornerRadius="4" Padding="12">
                <StackPanel Spacing="8">
                    <TextBlock Text="Общие настройки"
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>

                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="Начальная строка:"
                                   Style="{StaticResource BodyTextBlockStyle}"
                                   VerticalAlignment="Center"/>
                        <TextBox Text="{Binding StartRow, Mode=TwoWay}"
                                 Width="60"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- (2) Блок «Список столбцов» -->
            <Border BorderThickness="1" BorderBrush="Gray" CornerRadius="4" Padding="12">
                <StackPanel Spacing="8">
                    <TextBlock Text="Список столбцов:"
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>

                    <ListView ItemsSource="{Binding Columns}"
                              x:Name="ColumnsListView">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="models:ExportColumnDefinition">
                                <!-- StackPanel для каждого элемента + отступ внизу -->
                                <StackPanel Margin="0,0,0,8">
                                    <!-- Сетка 2x2 (две строки, по 2 «пары» в строке) -->
                                    <Grid ColumnDefinitions="Auto,*,Auto,*"
                                          RowDefinitions="Auto,Auto">
                                        <!-- Первая строка (Название / Номер столбца) -->
                                        <TextBlock Grid.Column="0" Grid.Row="0"
                                                   Text="Название:"
                                                   VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" Grid.Row="0"
                                                 Text="{x:Bind ColumnName, Mode=TwoWay}"
                                                 Width="120"
                                                 Margin="8,0,0,0"/>
                                        <TextBlock Grid.Column="2" Grid.Row="0"
                                                   Text="Номер столбца:"
                                                   VerticalAlignment="Center"
                                                   Margin="24,0,0,0"/>
                                        <TextBox Grid.Column="3" Grid.Row="0"
                                                 Text="{x:Bind ColumnIndex, Mode=TwoWay}"
                                                 Width="60"
                                                 Margin="8,0,0,0"/>

                                        <!-- Вторая строка (Свойство / Включён) -->
                                        <TextBlock Grid.Column="0" Grid.Row="1"
                                                   Text="Свойство:"
                                                   VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" Grid.Row="1"
                                                 Text="{x:Bind MappingProperty, Mode=TwoWay}"
                                                 Width="120"
                                                 Margin="8,0,0,0"/>
                                        <TextBlock Grid.Column="2" Grid.Row="1"
                                                   Text="Включён:"
                                                   VerticalAlignment="Center"
                                                   Margin="24,0,0,0"/>
                                        <CheckBox Grid.Column="3" Grid.Row="1"
                                                  IsChecked="{x:Bind IsVisible, Mode=TwoWay}"
                                                  VerticalAlignment="Center"
                                                  Margin="8,0,0,0"/>
                                    </Grid>

                                    <!-- Разделительная линия под элементом -->
                                    <Border BorderBrush="LightGray"
                                            BorderThickness="0,0,0,1"
                                            Margin="0,8,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <!-- Кнопки "Добавить" / "Удалить" -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Content="Добавить столбец"
                                Click="AddColumnButton_Click"/>
                        <Button Content="Удалить выбранный столбец"
                                Click="RemoveColumnButton_Click"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </StackPanel>

        <!-- Кнопка Сохранить -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="20">
            <Button Content="Сохранить"
                    Click="SaveButton_Click"/>
        </StackPanel>
    </Grid>
</Page>
