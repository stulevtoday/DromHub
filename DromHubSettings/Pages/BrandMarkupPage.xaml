<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="DromHubSettings.Pages.BrandMarkupsPage"
    x:Name="pageRoot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:DromHubSettings.ViewModels"
    xmlns:dialogs="using:DromHubSettings.Dialogs"
    xmlns:models="using:DromHubSettings.Models"
    xmlns:helpers="using:DromHubSettings.Helpers"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.DataContext>
        <vm:MarkupPageViewModel/>
    </Page.DataContext>

    <Page.Resources>
        <!-- Существующий конвертер -->
        <helpers:UpperCaseConverter x:Key="UpperCaseConverter"/>
        <!-- Коллекция сгруппированных наценок; свойство GroupedBrandMarkups должно быть реализовано во ViewModel -->
        <CollectionViewSource x:Key="GroupedBrandMarkups"
                              Source="{Binding GroupedBrandMarkups}"
                              IsSourceGrouped="True"/>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <StackPanel Grid.Row="0">
            <TextBlock Text="Локальности" 
               Margin="36,32,36,24"
               Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock Text="Управляйте списком локальностей и сроками доставки."
               Margin="36,0,36,20"
               Style="{ThemeResource BodyTextBlockStyle}"/>
        </StackPanel>
        
        <Grid Grid.Row="1" Margin="36,0,36,24">
            <Grid.ColumnDefinitions>
                <!-- Левая колонка (список) -->
                <ColumnDefinition Width="350" />
                <!-- Правая колонка (детальная форма) -->
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- СПИСОК (левая часть) -->
            <ListView Grid.Column="0"
                      x:Name="BrandMarkupsListView"
                      ItemsSource="{Binding Source={StaticResource GroupedBrandMarkups}}"
                      SelectedItem="{Binding SelectedMarkup, Mode=TwoWay}"
                      SelectionMode="Single"
                      Margin="8"
                      BorderThickness="1"
                      BorderBrush="Gray"
                      CornerRadius="4">
                <!-- Заголовки групп -->
                <ListView.GroupStyle>
                    <GroupStyle>
                        <GroupStyle.HeaderTemplate>
                            <DataTemplate>
                                <!-- Здесь для заголовка группы используем тот же стиль, что и для шапки таблицы -->
                                <TextBlock Text="{Binding Key}"
                               Style="{StaticResource TitleTextBlockStyle}"
                               AutomationProperties.AccessibilityView="Raw"/>
                            </DataTemplate>
                        </GroupStyle.HeaderTemplate>
                    </GroupStyle>
                </ListView.GroupStyle>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:BrandMarkup">
                        <!-- Корневой контейнер DataTemplate -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <!-- Первый столбец «растягивается» -->
                                <ColumnDefinition Width="*" />
                                <!-- Второй столбец «автоматический» -->
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!-- Название бренда (верхний регистр) -->
                            <TextBlock Text="{x:Bind BrandName, Converter={StaticResource UpperCaseConverter}}"
                   Style="{StaticResource BodyStrongTextBlockStyle}"
                   Grid.Column="0"
                   Margin="0,0,10,0"
                   HorizontalAlignment="Left" />

                            <!-- Наценка -->
                            <TextBlock Text="{x:Bind Markup}"
                   Style="{StaticResource BodyTextBlockStyle}"
                   Grid.Column="1"
                   HorizontalAlignment="Right" />
                        </Grid>
                    </DataTemplate>


                </ListView.ItemTemplate>
            </ListView>
            <!-- ДЕТАЛЬ (правая часть) -->
            <StackPanel Grid.Row="1" Grid.Column="1"
            Margin="16"
            Spacing="8"
            HorizontalAlignment="Left"
            VerticalAlignment="Top">

                <!-- Пример текстового поля для BrandName -->
                <TextBox Width="300"
             Header="Имя бренда"
             Text="{Binding SelectedMarkup.BrandName, Mode=TwoWay}"
             PlaceholderText="Введите название бренда" />

                <!-- Пример числового поля для Markup -->
                <NumberBox Width="200"
               Header="Наценка (%)"
               Value="{Binding SelectedMarkup.Markup, Mode=TwoWay}"
               Minimum="0" Maximum="1000"
               PlaceholderText="Наценка" />

                
            </StackPanel>
        </Grid>
        <!-- Кнопки внизу -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12">
            <Button Content="Добавить"
Command="{Binding AddCommand}" />
            <Button Content="Сохранить"
Command="{Binding SaveCommand}" />
        </StackPanel>


    </Grid>
</Page>
